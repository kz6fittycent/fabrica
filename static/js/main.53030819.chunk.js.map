{"version":3,"sources":["components/Messages.js","components/Utils.js","components/Header.js","components/constants.js","components/api.js","components/Build.js","components/BuildList.js","components/DetailsCard.js","components/BuildLog.js","App.js","index.js"],"names":["T","message","Messages","formatError","data","code","links","Header","props","state","l","this","sectionId","section","id","class","className","href","src","alt","role","map","active","subsection","key","link","Component","Constants","baseUrl","window","location","protocol","hostname","port","service","build","repo","cancelCallback","axios","post","constants","buildList","get","buildGet","buildId","Build","handleRepoChange","e","preventDefault","setState","target","value","handleClick","api","then","response","catch","console","log","error","title","onChange","type","placeholder","label","onClick","appearance","BuildList","handleBuildClick","getData","handleShowClick","expandedRow","builds","expanded","expandedContent","records","r","columns","content","name","created","headers","rows","DetailsCard","fields","f","size","BuildLog","poll","setTimeout","bind","record","finally","logs","status","renderLog","App","parts","pathname","split","length","parseRoute","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.53030819.chunk.js","sourcesContent":["export default {\n    'build': 'Build',\n    'build-log': 'Build Log',\n    'build-title': 'Build a snap',\n    'created': 'Created',\n    'getting-ready': 'Getting ready for lift off...',\n    'name': 'Name',\n    'repo': 'Repository',\n    'status': 'Status',\n}","import Messages from './Messages'\n\nexport function T(message) {\n    const msg = Messages[message] || message;\n    return msg\n}\n\nexport function formatError(data) {\n    let message = T(data.code);\n    if (data.message) {\n        message += ': ' + data.message;\n    }\n    return message;\n}\n\n// URL is in the form:\n//  /section\n//  /section/sectionId\n//  /section/sectionId/subsection\nexport function parseRoute() {\n    const parts = window.location.pathname.split('/')\n\n    switch (parts.length) {\n        case 2:\n            return {section: parts[1]}\n        case 3:\n            return {section: parts[1], sectionId: parts[2]}\n        case 4:\n            return {section: parts[1], sectionId: parts[2], subsection: parts[3]}\n        default:\n            return {}\n    }\n}","import React, { Component } from 'react';\nimport {T} from \"./Utils\";\n\n\nlet links = [];\n\nclass Header extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {};\n    }\n\n    link(l) {\n        if (this.props.sectionId) {\n            // This is the secondary menu\n            return '/' + this.props.section + '/' + this.props.sectionId + '/' + l;\n        } else {\n            return '/' + l;\n        }\n    }\n\n    render() {\n        return (\n            <header id=\"navigation\" class=\"p-navigation header-slim\">\n                <div className=\"p-navigation__banner row\">\n                    <div className=\"p-navigation__logo\">\n                        <div className=\"u-vertically-center\">\n                            <a href=\"/\" className=\"p-navigation__link\">\n                                <img src=\"/static/images/fabrica.png\" alt=\"ubuntu\" />\n                            </a>\n                        </div>\n                    </div>\n\n                    <nav className=\"p-navigation__nav\">\n                        <span className=\"u-off-screen\"><a href=\"#navigation\">Jump to site</a></span>\n                        <ul className=\"p-navigation__links\" role=\"menu\">\n                            {links.map((l) => {\n                                var active = '';\n                                if ((this.props.section === l) || (this.props.subsection === l)) {\n                                    active = ' active'\n                                }\n                                return (\n                                    <li key={l} className={'p-navigation__link' + active} role=\"menuitem\"><a href={this.link(l)}>{T(l)}</a></li>\n                                )\n                            })}\n                        </ul>\n                    </nav>\n                </div>\n            </header>\n        );\n    }\n}\n\nexport default Header;","const API_PREFIX = '/v1/'\n\nfunction getBaseURL() {\n    return window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + API_PREFIX;\n}\n\nlet Constants = {\n    baseUrl: getBaseURL(),\n}\n\nexport default Constants\n","import axios from 'axios'\nimport constants from './constants'\n\nlet service = {\n    build: (repo, cancelCallback) => {\n        return axios.post(constants.baseUrl + 'build', {repo: repo});\n    },\n\n    buildList: (cancelCallback) => {\n        return axios.get(constants.baseUrl + 'builds');\n    },\n\n    buildGet: (buildId, cancelCallback) => {\n        return axios.get(constants.baseUrl + 'builds/' + buildId);\n    },\n}\n\nexport default service","import React, {Component} from 'react';\nimport {Button, Card, Form, Input, Row} from \"@canonical/react-components\";\nimport {T, formatError} from \"./Utils\";\nimport api from './api'\n\nclass Build extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {repo: ''}\n    }\n\n    handleRepoChange = (e) => {\n        e.preventDefault()\n        this.setState({repo: e.target.value})\n    }\n\n    handleClick = (e) => {\n        e.preventDefault()\n        api.build(this.state.repo).then(response => {\n            window.location.href = '/builds/' + response.data.message\n        })\n        .catch(e => {\n            console.log(formatError(e.response.data))\n            this.setState({error: formatError(e.response.data), message: ''});\n        })\n    }\n\n    render() {\n        return (\n            <Row>\n                <br />\n                <Card title={T('build-title')}>\n                    <Form>\n                        <Input onChange={this.handleRepoChange} type=\"text\" id=\"repo\" placeholder=\"https://github.com/ogra1/fabrica.git\" label=\"Git Repo\" value={this.state.repo}/>\n                        <Button onClick={this.handleClick} appearance=\"positive\">{T('build')}</Button>\n                    </Form>\n                </Card>\n            </Row>\n        );\n    }\n}\n\nexport default Build;","import React, {Component} from 'react';\nimport api from \"./api\";\nimport {formatError, T} from \"./Utils\";\nimport {MainTable, Link} from \"@canonical/react-components\";\nimport Build from \"./Build\";\n\nclass BuildList extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            builds: [],\n            expanded: false,\n            expandedContent: null,\n        }\n    }\n\n    getData() {\n        api.buildList().then(response => {\n            this.setState({builds: response.data.records})\n        })\n        .catch(e => {\n            console.log(formatError(e.response.data))\n            this.setState({error: formatError(e.response.data), message: ''});\n        })\n    }\n\n    componentDidMount() {\n        this.getData()\n    }\n\n    handleBuildClick = (e) => {\n        e.preventDefault()\n        this.getData()\n    }\n\n    handleShowClick = (e) => {\n        this.setState({expandedRow: 1})\n    }\n\n    render() {\n\n        let data = this.state.builds.map(r => {\n            return {\n                columns:[\n                    {content: r.name, role: 'rowheader'},\n                    {content: r.repo},\n                    {content: r.created},\n                    {content: <Link href={'/builds/'+r.id}>{T('show')}</Link>}\n                    ],\n            }\n        })\n\n        return (\n            <div>\n                <Build onClick={this.handleBuildClick} />\n                <MainTable headers={[\n                {\n                    content: T('name')\n                }, {\n                    content: T('repo')\n                }, {\n                    content: T('created')\n                }, {\n                    content: ''\n                }]} rows={data} />\n            </div>\n        );\n    }\n}\n\nexport default BuildList;","import React from 'react';\nimport {Card, Row, Col} from \"@canonical/react-components\";\n\nfunction DetailsCard(props) {\n    return (\n        <Card>\n            {props.fields.map(f => {\n                return (\n                    <Row>\n                        <Col size={2}>{f.label}:</Col>\n                        <Col size={10} className=\"field_value\">{f.value}</Col>\n                    </Row>\n                )\n            })}\n        </Card>\n    );\n}\n\nexport default DetailsCard;","import React, {Component} from 'react';\nimport api from \"./api\";\nimport {formatError, T} from \"./Utils\";\nimport {Row, Code} from '@canonical/react-components'\nimport DetailsCard from \"./DetailsCard\";\n\nclass BuildLog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            build: {},\n        }\n    }\n\n    componentDidMount() {\n        this.getData()\n    }\n\n    poll = () => {\n        // Polls every 0.5s\n        setTimeout(this.getData.bind(this), 500);\n    }\n\n    getData() {\n        api.buildGet(this.props.buildId).then(response => {\n            this.setState({build: response.data.record})\n        })\n        .catch(e => {\n            console.log(formatError(e.response.data))\n            this.setState({error: formatError(e.response.data), message: ''});\n        })\n        .finally( ()=> {\n            this.poll()\n        })\n    }\n\n    renderLog() {\n        if (!this.state.build.logs) {return T('getting-ready')+ '\\r\\n'}\n\n        return this.state.build.logs.map(l => {\n            return l.message + '\\r\\n'\n        })\n    }\n\n    render() {\n        return (\n            <Row>\n                <h3>{T('build-log')}</h3>\n                <Row>\n                    <DetailsCard fields={[\n                        {label: T('name'), value: this.state.build.name},\n                        {label: T('repo'), value: this.state.build.repo},\n                        {label: T('created'), value: this.state.build.created},\n                        {label: T('status'), value: this.state.build.status},\n                        ]} />\n                    <Code>\n                        {this.renderLog()}\n                    </Code>\n                </Row>\n            </Row>\n        );\n    }\n}\n\nexport default BuildLog;","import React, {Component} from 'react';\nimport Header from \"./components/Header\";\nimport BuildList from \"./components/BuildList\";\nimport {parseRoute} from \"./components/Utils\";\nimport BuildLog from \"./components/BuildLog\";\n//import createHistory from 'history/createBrowserHistory'\n\n//const history = createHistory()\n\nclass App extends Component {\n    // handleNavigation(location) {\n    //     this.setState({ location: location })\n    //     window.scrollTo(0, 0)\n    // }\n\n    render() {\n        const r = parseRoute()\n\n        return (\n            <div>\n                <Header/>\n\n                {r.section===''? <BuildList/> : ''}\n                {r.section==='builds'? <BuildLog buildId={r.sectionId} /> : ''}\n\n            </div>\n        );\n    }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport \"./scss/index.scss\";\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}